jQuery(document).ready((function($){if($(".btn-toggle-slidedown").on("click",(function(){if($(this).data("target")){var target=$("#"+$(this).data("target"));target.hasClass("slidedown-active")?(target.removeClass("slidedown-active"),$("#overlay").addClass("d-none"),$("body").removeClass("modal-open"),target.slideUp()):($(".slidedown-active").removeClass("slidedown-active").hide(),target.slideDown().addClass("slidedown-active"),$("#overlay").removeClass("d-none"),$("body").addClass("modal-open"))}})),$(".btn-toggle-network-mobile").on("click",(function(){$(this).toggleClass("active"),$("#network-mobile").slideToggle(),$("#search-nav-wrap").slideToggle()})),$("#overlay").on("click",(function(){$(this).addClass("d-none"),$("body").removeClass("modal-open"),$(".slidedown-active").removeClass("slidedown-active").hide(),$(".nav-wrap").removeClass("active"),$(".modal").hide()})),$(".btn-toggle-menu").on("click",(function(){$(".nav-wrap").addClass("active"),$("#overlay").removeClass("d-none"),$("body").addClass("modal-open")})),$(".btn-close-menu").on("click",(function(){$(".nav-wrap").removeClass("active"),$("#overlay").addClass("d-none"),$("body").removeClass("modal-open")})),$('[data-toggle="modal"]').on("click",(function(e){e.preventDefault();var target=$($(this).data("target"));$("body").addClass("modal-open"),$("#overlay").removeClass("d-none"),target.fadeIn()})),$(".modal .close").on("click",(function(e){var target;e.preventDefault(),$(this).closest(".modal").fadeOut(),$("#overlay").addClass("d-none"),$("body").removeClass("modal-open")})),$(".btn-open-top-search").on("click",(function(){$("#top-search-wrap").addClass("active")})),$(".btn-close-top-search").on("click",(function(){$("#top-search-wrap").removeClass("active")})),$(window).width()<768&&$(document).on("click",".nav-v .toggle-nav, .nav-v.collapsed .active",(function(e){e.preventDefault(),$(this).closest(".nav-v").toggleClass("collapsed").find("li").toggleClass("open")})),$(".observer-list .topics-active a").on("click",(function(e){var btn;if(e.preventDefault(),$(this).hasClass("subscribed"))var status="unsubscribed";else var status="subscribed";var list=$(this).data("list"),data={action:"subscribe_observer",formData:"list="+list+"&status="+status};$.post(brag_observer.url,data,(function(res){res.success&&$("a[data-list="+list+"]").toggleClass("subscribed")}))})),$("body").on("click",".yt-lazy-load",(function(){var video_id=$(this).data("id"),player_id=$(this).prop("id"),player_height=$(this).height(),player;function onPlayerReady(event){event.target.playVideo()}player=new YT.Player(player_id,{height:player_height,videoId:video_id,events:{onReady:onPlayerReady}})})),$(".l_video").on("click",(function(e){e.preventDefault();var yt=$(this).data("youtube");$("#tb-video-modal .modal-body").html("");var i='<iframe width="560" height="349" src="http://www.youtube.com/embed/'+yt+'?rel=0&autoplay=1&color=white" frameborder="0" allowfullscreen ></iframe>';$("#tb-video-modal .modal-body").html(i),$("#tb-video-modal").modal("show")})),$("#tb-video-modal").on("hidden.bs.modal",(function(){$("#tb-video-modal .modal-body").html("")})),$(".datepicker").length&&$(".datepicker").datepicker({format:"dd M yyyy"}),$("body").on("click",".social-share-link",(function(o){return o.preventDefault(),window.open($(this).attr("href"),$(this).data("type"),"height=450, width=550, top="+($(window).height()/2-225)+", left="+($(window).width()/2-275)+", toolbar=0, location=0, menubar=0, directories=0, scrollbars=0"),!1})),$("#articles-wrap").length){$("#articles-wrap").append('<div class="load-more">Loading...</div>');var button=$("#articles-wrap .load-more"),loading=!1,scrollHandling={allow:!0,reallow:function(){scrollHandling.allow=!0},delay:400},count_articles=2}var progress_top=0,winTop=$(window).scrollTop(),page_title=document.title,page_url=document.location.protocol+"//"+document.location.host+document.location.pathname,$news_stories=$(".single-article"),top_news_story=$.grep($news_stories,(function(item){return $(item).position().top<=winTop+10})),visible_news_story=$.grep($news_stories,(function(item){return $(item).position().top<=winTop+$(window).height()-$("#header").outerHeight()})),winHeight=$(window).height();$(window).scroll((function(){if(winTop=$(this).scrollTop(),$(window).width()<768){var mainTop=$("main").length?$("main").offset().top:0,billboardHeight=$(".ad-billboard-top").length?$(".ad-billboard-top").height():0;winTop>=$(window).height()/2&&$(".ad-billboard-top").addClass("sticky").slideDown()}if($(".single").length){if($("#articles-wrap").length&&count_articles<4){if(!loading&&scrollHandling.allow){scrollHandling.allow=!1,setTimeout(scrollHandling.reallow,scrollHandling.delay);var offset=$(button).offset().top-$(window).scrollTop()-$(window).outerHeight();if(1.5*winHeight>offset){loading=!0;var data={action:"tbm_ajax_load_next_post",exclude_posts:tbm_load_next_post.exclude_posts,id:tbm_load_next_post.current_post,count_articles:count_articles};$.post(tbm_load_next_post.url,data,(function(res){if(res.success){"undefined"!=res.data.page_title&&count_articles++,tbm_load_next_post.current_post=res.data.loaded_post,tbm_load_next_post.exclude_posts+=","+res.data.loaded_post,$("#articles-wrap").append(res.data.content),$("#articles-wrap").append(button),fusetag.setTargeting("fuse_category",["'"+res.data.category+"'"]);var bbSlot=fusetag.getAdSlotsById("22339226185");if(void 0!==bbSlot){var slotResponseInformation=bbSlot[0].getResponseInformation();void 0!==slotResponseInformation&&void 0!==slotResponseInformation.lineItemId&&fusetag.setTargeting("LineItemId",["'"+slotResponseInformation.lineItemId+"'"])}fusetag.setTargeting("pagepath",["'"+res.data.pagepath+"'"]),loading=!1}else button.remove()})).fail((function(xhr,textStatus,e){}))}}}else void 0!==button&&button.remove();if(void 0!==button){if($news_stories=$(".single-article"),top_news_story=$.grep($news_stories,(function(item){return $(item).position().top<=winTop+100})),visible_news_story=$.grep($news_stories,(function(item){return $(item).position().top<=winTop+$(window).height()/2})),""!=$(visible_news_story).last().prop("id")){var progress=1-((progress_top=$(visible_news_story).last().offset().top+$(visible_news_story).last().outerHeight()-30)-winTop-$(window).height())/$(visible_news_story).last().outerHeight();progress<0?progress=0:progress>1&&(progress=1)}if(""!=$(visible_news_story).last().find("h1").text()&&page_url!=$(visible_news_story).last().find("h1").data("href")){page_title_html=$(visible_news_story).last().find("h1").data("title"),page_title=$("<textarea />").html(page_title_html).text(),page_url=$(visible_news_story).last().find("h1").data("href");var author=$(visible_news_story).last().find(".author").data("author"),cats=$(visible_news_story).last().find(".cats").data("category"),tags=$(visible_news_story).last().find(".cats").data("tags"),pubdate=$(visible_news_story).last().find("time").data("pubdate");window.dataLayer=window.dataLayer||[],window.dataLayer.push({AuthorCD:author,CategoryCD:cats,TagsCD:tags,PubdateCD:pubdate}),document.title=page_title,window.history.pushState(null,page_title,page_url),article_number=$(visible_news_story).last().find("h1").data("article-number")}}if($(visible_news_story).last().find(".observer-sub-form").length){var elemSubForm=$(visible_news_story).last().find(".observer-sub-form");elemSubForm.closest("blockquote").length>0&&elemSubForm.detach(),$(window).scrollTop()<elemSubForm.offset().top+elemSubForm.outerHeight()-$(window).height()/2&&$(window).scrollTop()+$(window).innerHeight()>elemSubForm.offset().top+$(window).height()/2?elemSubForm.closest(".single-article").find(".overlay").first().fadeIn():elemSubForm.closest(".single-article").find(".overlay").first().fadeOut()}$(".single-article .overlay").length&&$(".single-article .overlay").on("click",(function(){$(this).remove()}))}})),$(".btn-join").length&&$(document).on("click",".btn-join",(function(){$(window).width()<768&&$(this).closest(".observer-sub-form").find(".img-wrap").first().hide();var theForm=$(this).next("form.observer-subscribe-form");theForm.removeClass("d-none"),theForm.find('input[name="email"]').focus(),$(this).remove()})),$(document).on("submit",".observer-subscribe-form",(function(e){e.preventDefault();var theForm=$(this);const re=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(theForm.find('input[name="email"]').length&&(""==theForm.find('input[name="email"]').val()||!re.test(String(theForm.find('input[name="email"]').val().toLowerCase()))))return theForm.parent().find(".js-errors-subscribe").html("Please enter a valid email address.").removeClass("d-none"),!1;var formData=$(this).serialize(),loadingElem=$(this).find(".loading"),button=$(this).find(".button"),the_url;formData+="&source="+theForm.closest(".single-article").find("h1:first").data("href"),$(".js-errors-subscribe,.js-msg-subscribe").html("").addClass("d-none"),loadingElem.show(),button.hide();var data={action:"subscribe_observer_category",formData:formData};$.post(tbm_load_next_post.url,data,(function(res){res.success?(theForm.parent().find(".js-msg-subscribe").html(res.data.message).removeClass("d-none"),theForm.hide()):(theForm.parent().find(".js-errors-subscribe").html(res.data.error.message).removeClass("d-none"),button.show()),loadingElem.hide()})).error((function(){theForm.parent().find(".js-errors-subscribe").html("Something went wrong, please try again later").removeClass("d-none"),loadingElem.hide(),button.show()}))}))}));